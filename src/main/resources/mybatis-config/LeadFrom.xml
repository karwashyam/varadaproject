<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.webapp.daos.LeadFromDao">
	
	
	
	
	<insert id="addLead" parameterType="LeadModel">
		INSERT INTO leads(
            lead_id, email, phone, lead_from, created_at)
    	VALUES (#{leadId}, #{email}, #{phone}, #{leadFrom}, #{createdAt})
	</insert>
	
	
	
	<select id="fetchLeads" parameterType="JQTableUtils" resultType="LeadJsonDto">
		SELECT 
			email, lead_from AS leadFrom, phone,
       		created_at
  		FROM leads
  		WHERE lead_id!='A'
  		<if test="JQTableUtils.searchParams!=''">
			AND
			(
				email ilike #{JQTableUtils.searchParams}
				OR
				phone ilike #{JQTableUtils.searchParams}
				OR
				lead_from ilike #{JQTableUtils.searchParams}
			)
		</if>
		ORDER BY
			created_at
				DESC
		<if test="JQTableUtils.iDisplayLength!=-1">
			LIMIT #{JQTableUtils.iDisplayLength}
			OFFSET #{JQTableUtils.iDisplayStart}
		</if>
		
	</select>
	
	<select id="fetchTotalLeads" parameterType="JQTableUtils" resultType="long">
		SELECT 
			count(*)
  		FROM leads
  		WHERE lead_id!='A'
  		<if test="JQTableUtils.searchParams!=''">
			AND
			(
				email ilike #{JQTableUtils.searchParams}
				OR
				phone ilike #{JQTableUtils.searchParams}
				OR
				lead_from ilike #{JQTableUtils.searchParams}
			)
		</if>
	</select>
</mapper>